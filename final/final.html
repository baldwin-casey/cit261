<!DOCTYPE html>
<head>
<link rel="shortcut icon" type="image/png" href="../favicon.png"/>
<style>
div.info {
padding: 8px;
border: dashed 2px;
border-style: rounded;
}
div.buttons {
padding: 8px;
border: dashed 2px;
}
</style>
</head>
<body>
<div class="display">
<div class="info">
<h1>Taipan</h1>
<p>Select an option to begin!</p>
</div>
<div class="buttons">
<button onclick="newgame()">New Game</button>
<button onclick="loadgame()">Load Game</button>
<button onclick="localStorage.clear();">Clear Saved Game</button>
<button onclick="aboutgame()">About Game</button>
</div>
</div>
<script>
//A copy of the game can be found here https://github.com/ebassett/taipan/blob/master/taipan.c
//Here are the global variables that the game manipulates
var currentdate;
var name;
var currentlocation;
var debt = 0;
var cash = 0;
var bank = 0;
var shipsize;
//Need to intialize this first, so that it appears as a number
var currentweight = 0;
var shipcondition;
var cannons;
var generalcargo;
var arms;
var silk;
var blackmarketcargo;
var mute;
//These are the starting\test values. This is subject to change
var generalcargoprice = 5;
var armsprice = 30;
var silkprice = 500;
var blackmarketcargoprice = 6000;
var itemvalue;
var itemselected;

//here are the functions from the first page
function newgame() {
name = prompt("Enter Your Company Name", "7 Seas");
currentdate = new Date(1832, 0);
currentlocation = 'Beijing';
shipsize = 100;
shipcondition = 100;
cannons = 5;
bank = 0;
generalcargo = 0;
arms = 0;
silk = 0;
blackmarketcargo = 0;
document.getElementsByClassName("info")[0].innerHTML = "Do you want to start with money and debt or no debt and no money?";
document.getElementsByClassName("buttons")[0].innerHTML = '<button onclick="startwithdebt()"> Start with Debt</button><br> <button onclick="startwithoutdebt()">Start Without Debt</button>';
}


function loadgame() {
if (localStorage.getItem("name") === null && localStorage.getItem("currentlocation") === null) {
document.getElementsByClassName("info")[0].innerHTML = ('No saved game found!<br>Please select a different option');
}
else {
name = localStorage.getItem("name");
currentdate = new Date(localStorage.getItem("currentdate"));
//not sure why Javascript doesnt keep the months correctly, but this line is to set the date to the right month, else it is behind 1 month.
currentdate.setMonth(currentdate.getMonth() + 1);
currentlocation = localStorage.getItem("currentlocation");
debt = localStorage.getItem("debt");
cash = localStorage.getItem("cash");
bank = localStorage.getItem("bank");
shipsize = localStorage.getItem("shipsize");
shipcondition = localStorage.getItem("shipcondition");
cannons = localStorage.getItem("cannons");
generalcargo = localStorage.getItem("generalcargo");
arms = localStorage.getItem("arms");
silk = localStorage.getItem("silk");
blackmarketcargo = localStorage.getItem("blackmarketcargo");
display();
}
}

function aboutgame() {
document.getElementsByClassName("info")[0].innerHTML = "Taipan was originally released in 1982 for the TRS80 and Apple 2.";
document.getElementsByClassName("buttons")[0].innerHTML = "<button onclick='returnmain()'>Return to main game</button>"
}

//Starting with or without debt
function startwithdebt() {
cash = 3000;
debt = 3000;
display();
}

function startwithoutdebt() {
cash = 0;
debt = 0;
display();
}

//Here are the options for each city view
function savegame() {
localStorage.setItem("name", name);
localStorage.setItem("currentdate", currentdate);
localStorage.setItem("currentlocation", currentlocation);
localStorage.setItem("debt", debt);
localStorage.setItem("cash", cash);
localStorage.setItem("bank", bank);
localStorage.setItem("shipsize", shipsize);
localStorage.setItem("shipcondition", shipcondition);
localStorage.setItem("cannons", cannons);
localStorage.setItem("generalcargo", generalcargo);
localStorage.setItem("arms", arms);
localStorage.setItem("silk", silk);
localStorage.setItem("blackmarketcargo", blackmarketcargo);
}

function returnmain() {
document.getElementsByClassName("info")[0].innerHTML = "<h1>Taipan</h1><p>Select an option to begin!</p>";
document.getElementsByClassName("buttons")[0].innerHTML = '<button onclick="newgame()">New Game</button> <button onclick="loadgame()">Load Game</button> <button onclick="localStorage.clear();">Clear Saved Game</button> <button onclick="aboutgame()">About Game</button>';
}

//This refreshes the main display for the game, which allows you to buy, sell or visit bank.
function display() {
calculateweight();

if (currentlocation != 'Beijing') {
document.getElementsByClassName("info")[0].innerHTML = "Welcome to " + currentlocation + "!<br>Date: " + currentdate.toLocaleString('en-us', { year: 'numeric', month: 'long' })  + "<br>Cash: " + cash + "<br>Bank: " + bank + "<br>Debt: " + debt + "<br>Ship Condition: " +  shipcondition + "%" + "<br>Ship Capacity: " + shipsize + "<br>Cannons: " + cannons + '<br>Current Inventory: <span id="load">' + currentweight + "</span><br>General Cargo: " + generalcargo + "<br>Arms: " + arms + "<br>Silk: " + silk + "<br>Black Market Cargo: " + blackmarketcargo;
document.getElementsByClassName("buttons")[0].innerHTML = '<button id="buy" onclick="buy()"> Buy Goods</button><br> <button id="sell" onclick="sell()">Sell Goods</button><br> <button id="visitbank" onclick="visitbank()">Visit The Bank</button><br> <button id="leaveport" onclick="leaveport()">Leave The Port</button><br> <button onclick="savegame()">Save Game</button> <br><button id="retire" onclick="retire()">Retire</button>';
}
else {
document.getElementsByClassName("info")[0].innerHTML = "Welcome to " + currentlocation + "!<br>Date: " + currentdate.toLocaleString('en-us', { year: 'numeric', month: 'long' }) + "<br>Cash: " + cash + "<br>Bank: " + bank + "<br>Debt: " + debt + "<br>Ship Condition: " +  shipcondition + "%" + "<br>Ship Capacity: " + shipsize + "<br>Cannons: " + cannons + '<br>Current Inventory: <span id="load">' + currentweight + "</span><br>General Cargo: " + generalcargo + "<br>Arms: " + arms + "<br>Silk: " + silk + "<br>Black Market Cargo: " + blackmarketcargo;
document.getElementsByClassName("buttons")[0].innerHTML = '<button id="buy" onclick="buy()"> Buy Goods</button><br> <button id="sell" onclick="sell()">Sell Goods</button><br> <button id="visitbank" onclick="visitbank()">Visit The Bank</button><br> <button id="visitmoneylender" onclick="visitmoneylender()"> Visit Moneylender</button><br> <button id="leaveport" onclick="leaveport()">Leave The Port</button><br> <button onclick="savegame()">Save Game</button> <br><button id="retire" onclick="retire()">Retire</button>';

}
//This changes the load to be colored red if the ship is overloaded
if (currentweight > shipsize) {
document.getElementById("load").style.backgroundColor = "red";
document.getElementById("load").innerHTML += " - Your Ship is Overloaded!"
document.getElementById("leaveport").style.backgroundColor = "red";
document.getElementById("leaveport").disabled = true;
}

//Check if you have money to deposit into bank or money to withdraw. If neither, the bank is kinda pointless
if (bank == 0 && cash == 0) {
document.getElementById("visitbank").disabled = true;
document.getElementById("visitbank").style.backgroundColor = "red";
}

//If you don't have money, you can't go to places that need money
if (cash == 0) {
document.getElementById("visitmoneylender").disabled = true;
document.getElementById("visitmoneylender").style.backgroundColor = "red";
document.getElementById("buy").disabled = true;
document.getElementById("buy").style.backgroundColor = "red";
}

//If you have no goods, you cant sell anything, so the button is disabled
if (generalcargo == 0) {
	if (arms == 0) {
		if (silk == 0) {
			if (blackmarketcargo == 0) {
				document.getElementById("sell").disabled = true;
				document.getElementById("sell").style.backgroundColor = "red";
			}
		}
	}
}

var totalworth = parseInt(cash) + parseInt(bank);
//Check if you have enough money to retire
if (totalworth < 1000000) {
document.getElementById("retire").style.backgroundColor = "red";
document.getElementById("retire").disabled = true;
}
}

//this is the deposit screen
function visitbank() {
document.getElementsByClassName("info")[0].innerHTML = "Welcome to the bank!<br> How much would you like to deposit?"
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="bankdeposit"> Max ' + cash + '<br><button onclick="depositcash()">Confirm</button> <button onclick="display()">Cancel</button>';

}

function depositcash() {
bank = parseInt(bank) + parseInt(document.getElementById("bankdeposit").value);
cash = parseInt(cash) - parseInt(document.getElementById("bankdeposit").value);
visitbank2();
}

//This is the display screen for withdraws
function visitbank2() {
document.getElementsByClassName("info")[0].innerHTML = "Welcome to the bank!<br> How much would you like to withdraw?"
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="bankwithdraw"> Max ' + bank + '<br><button onclick="withdrawcash()">Confirm</button> <button onclick="display()">Cancel</button>';

}

function withdrawcash() {
if (document.getElementById("bankwithdraw").value !== '') {
bank = parseInt(bank) - parseInt(document.getElementById("bankwithdraw").value);
cash = parseInt(cash) + parseInt(document.getElementById("bankwithdraw").value);
}
display();
}

//Get a loan or pay off a loan
function visitmoneylender() {
document.getElementsByClassName("info")[0].innerHTML = "Welcome to the money lender. You owe " + debt;
document.getElementsByClassName("buttons")[0].innerHTML = '<button onclick="getloanamount()">Get a Loan</button><br><button id="payoffloan" onclick="getpayloanamount()">Pay Off Loan</button><br><button onclick="display()">Cancel</button>';
if (debt === 0) {
document.getElementById("payoffloan").disabled = true;
document.getElementById("payoffloan").style.backgroundColor = "red";
}
}

function getloanamount() {
document.getElementsByClassName("info")[0].innerHTML = 'Welcome to the money lender. You owe ' + debt + '<br>The amount grows by 3% per month. How much would you like to borrow?';
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="loanamount"><br><button onclick="getloan()">Get Loan</button><button onclick="display()">Cancel</button>';
document.getElementById("loanamount").focus();
}

function getloan() {
debt = parseInt(debt) + parseInt(document.getElementById("loanamount").value);
cash = parseInt(cash) + parseInt(document.getElementById("loanamount").value)
display();
}


function getpayloanamount() {
document.getElementsByClassName("info")[0].innerHTML = 'Welcome to the money lender. You owe ' + debt + '<br>How much would you like to pay off?';
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="repayloanamount"><br><button onclick="payloan()">Pay Loan</button><button onclick="display()">Cancel</button>';
document.getElementById("repayloanamount").focus();
}

function payloan() {
debt = parseInt(debt) - parseInt(document.getElementById("repayloanamount").value);
cash = parseInt(cash) - parseInt(document.getElementById("repayloanamount").value)
display();
}
 
//Buy things from the market
function buy() {
document.getElementsByClassName("info")[0].innerHTML = "What would you like to buy?<br>General Cargo: " + generalcargoprice + "<br>Arms: " + armsprice + "<br>Silk: " + silkprice + "<br>Black Market Cargo: " + blackmarketcargoprice + "<br><br>You have: " + cash;
document.getElementsByClassName("buttons")[0].innerHTML = '<button id="buygeneralcargo" onclick="buygeneralcargo()"> Buy General Cargo</button><br> <button id="buyarms" onclick="buyarms()">Buy Arms</button><br> <button id="buysilk" onclick="buysilk()">Buy Silk</button><br><button id="buyblackmarketcargo" onclick="buyblackmarketcargo()"> Buy Black Market Cargo</button><br> <button onclick="display()">Cancel</button>';
//If not enough money for a certain good, button will be disabled
if (cash < generalcargoprice) {
document.getElementById("buygeneralcargo").disabled = true;
document.getElementById("buygeneralcargo").style.backgroundColor = "red";
}
if (cash < armsprice) {
document.getElementById("buyarms").disabled = true;
document.getElementById("buyarms").style.backgroundColor = "red";
}

if (cash < silkprice) {
document.getElementById("buysilk").disabled = true;
document.getElementById("buysilk").style.backgroundColor = "red";
}
if (cash < blackmarketcargoprice) {
document.getElementById("buyblackmarketcargo").disabled = true;
document.getElementById("buyblackmarketcargo").style.backgroundColor = "red";
}

}

function buygeneralcargo() {
document.getElementsByClassName("info")[0].innerHTML = "How much general cargo would you like to buy?";
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + parseInt(cash/generalcargoprice) + '<br><button onclick="subtractmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = generalcargoprice;
itemselected = 'General Cargo';
}



function buyarms() {
document.getElementsByClassName("info")[0].innerHTML = "How many arms would you like to buy?<br>Cost:" + armsprice;
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + parseInt(cash/armsprice) + '<br><button onclick="subtractmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = armsprice;
itemselected = 'Arms';
}

function buysilk() {
document.getElementsByClassName("info")[0].innerHTML = "How much silk would you like to buy?4";
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + parseInt(cash/silkprice) + '<br><button onclick="subtractmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = silkprice;
itemselected = 'Silk';
}

function buyblackmarketcargo() {
document.getElementsByClassName("info")[0].innerHTML = "How much black market cargo would you like to buy?";
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + parseInt(cash/blackmarketcargoprice) + '<br><button onclick="subtractmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = blackmarketcargoprice;
itemselected = 'Black Market Cargo';
}

//------------------------------------------------------------------------FIX THIS
function subtractmoney() {

cash = parseInt(cash - document.getElementById("quantity").value * itemvalue);

switch(itemselected) {
case 'General Cargo':
if (document.getElementById("quantity").value * itemvalue > cash) {
generalcargo = generalcargo + parseInt(cash/generalcargoprice);
cash = parseInt(cash - generalcargo * itemvalue);
}
else {
cash = parseInt(document.getElementById("quantity").value * itemvalue);
}
break;
case 'Arms':
arms = parseInt(arms + document.getElementById("quantity").value);
break;
case 'Silk':
silk = parseInt(silk + document.getElementById("quantity").value);
break;
case 'Black Market Cargo':
blackmarketcargo = parseInt(blackmarketcargo + document.getElementById("quantity").value);
}
document.getElementsByClassName("info")[0].innerHTML = document.getElementById("quantity").value + " of " + itemselected + " for a total cost of " + document.getElementById("quantity").value * itemvalue;
itemselected = null;
display();
}

//Sell from inventory
function sell() {
document.getElementsByClassName("info")[0].innerHTML = "What would you like to sell?";
document.getElementsByClassName("buttons")[0].innerHTML = '<button id="sellgeneralcargo" onclick="sellgeneralcargo()"> Sell General Cargo</button><br> <button id="sellarms" onclick="sellarms()">Sell Arms</button><br> <button id="sellsilk" onclick="sellsilk()">Sell Silk</button><br><button id="sellblackmarketcargo" onclick="sellblackmarketcargo()"> Sell General Black Market Cargo</button><br> <button onclick="display()">Cancel</button>';
//Check for number of items, if player does not have certain good, the button is disabled
if (generalcargo == 0) {
document.getElementById("sellgeneralcargo").disabled = true;
document.getElementById("sellgeneralcargo").style.backgroundColor = "red";
}

if (arms == 0 || arms === '') {
document.getElementById("sellarms").disabled = true;
document.getElementById("sellarms").style.backgroundColor = "red";
}

if (silk == 0) {
document.getElementById("sellsilk").disabled = true;
document.getElementById("sellsilk").style.backgroundColor = "red";
}

if (blackmarketcargo == 0) {
document.getElementById("sellblackmarketcargo").disabled = true;
document.getElementById("sellblackmarketcargo").style.backgroundColor = "red";
}
}

function sellgeneralcargo() {
document.getElementsByClassName("info")[0].innerHTML = "How much general cargo would you like to sell?";
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + generalcargo + '<br><button onclick="addmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = generalcargoprice;
itemselected = 'General Cargo';
}

function sellarms() {
document.getElementsByClassName("info")[0].innerHTML = "How many arms would you like to sell?";
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + arms + '<br><button onclick="addmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = armsprice;
itemselected = 'Arms';
}

function sellsilk() {
document.getElementsByClassName("info")[0].innerHTML = "How much silk would you like to sell?";
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + silk + '<br><button onclick="addmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = silkprice;
itemselected = 'Silk';
}

function sellblackmarketcargo() {
document.getElementsByClassName("info")[0].innerHTML = "How much black market cargo would you like to sell?";
document.getElementsByClassName("buttons")[0].innerHTML = '<input type="number" id="quantity"> Max ' + blackmarketcargo + '<br><button onclick="addmoney()">Confirm</button> <button onclick="display()">Cancel</button>';
document.getElementById("quantity").focus();
itemvalue = blackmarketcargoprice;
itemselected = 'Black Market Cargo';
}
//----------------------------------------------------------------------------------------------NEEDS WORK
function addmoney() {
switch(itemselected) {
case 'General Cargo':
if (generalcargo < document.getElementById("quantity").value) {
display();
}
else {
generalcargo = parseInt(generalcargo - document.getElementById("quantity").value);
cash = parseInt(cash + document.getElementById("quantity").value * itemvalue);
}
break;
case 'Arms':
if (arms < document.getElementById("quantity").value) {
display();
}
else {
arms = parseInt(arms - document.getElementById("quantity").value);
cash = parseInt(cash + document.getElementById("quantity").value * itemvalue);
}
break;
case 'Silk':
if (silk < document.getElementById("quantity").value) {
display();
cash = parseInt(cash + document.getElementById("quantity").value * itemvalue);
}
else {
silk = parseInt(silk - document.getElementById("quantity").value);
cash = parseInt(cash + document.getElementById("quantity").value * itemvalue);
}
break;
case 'Black Market Cargo':
if (blackmarketcargo < document.getElementById("quantity").value) {
display();
}
else {
blackmarketcargo = parseInt(blackmarketcargo - document.getElementById("quantity").value);
cash = parseInt(cash + document.getElementById("quantity").value * itemvalue);
}
itemselected = null;
display();
}
}

//Leave the port to buy and sell elsewhere
function leaveport() {
document.getElementsByClassName("info")[0].innerHTML = "Where would you like to go?";
//This checks the value of the buttons and if they match current location, the button will be disabled and colored red.
document.getElementsByClassName("buttons")[0].innerHTML = '<button onclick="gotobeijing()" id="Beijing"> Go To Beijing</button><br><button onclick="gotomanilla()" id="Manilla"> Go To Manilla</button><br> <button onclick="gotopiratecove()" id="Pirate Cove"> Go To Pirate Cove</button><br> <button onclick="gotohongkong()" id="Hong Kong">Go To Hong Kong</button><br><button onclick="display()">Cancel</button>';
document.getElementById(currentlocation).disabled = true;
document.getElementById(currentlocation).style.backgroundColor = 'red';

}


//move the boat to the new location
function gotopiratecove() {
currentlocation = 'Pirate Cove';
addmonth();
display();
}

function gotomanilla() {
currentlocation = 'Manilla';
addmonth();
display();
}

function gotobeijing() {
currentlocation = 'Beijing';
addmonth();
display();
}

function gotohongkong() {
currentlocation = 'Hong Kong';
addmonth();
display();
}

//Moving the boat, calculate the time, 
function addmonth() {
currentdate.setMonth(currentdate.getMonth() + 1);
//check for debt, if there is debt, it grows by 3 percent every month
if (debt !== 0) {
//debt plus (debt multiplied by interest rate)
debt = parseInt(debt + debt * .03);
}

}

//calculates the current weight
function calculateweight() {
currentweight = parseInt(cannons) * 10 + parseInt(generalcargo) + parseInt(arms) + parseInt(silk) + parseInt(blackmarketcargo);
}

//battle
function battle() {
var chance;
var enemyships;
//This changes the difficulty of the encounter, 1 being the easiest and 20 being the hardest
var difficulty = math.random(20);

}

//This calculates the prices, some ports pay more for items while others less. Also different months of the year change what is in demand
function caluclateprices() {
console.log(currentdate.getMonth());

}

//This is the end of the game where stats are shown
function retire() {
var totalworth = parseInt(cash) + parseInt(bank);
document.getElementsByClassName("info")[0].innerHTML = "<h1>You are a millionaire!</h1><p>Your total worth was <b>" + totalworth + "</b>";
document.getElementsByClassName("buttons")[0].innerHTML = '<button onclick="location.reload()">Play Again</button>';
}
</script>

<footer>
<a href="https://baldwin-casey.github.io/cit261/">RETURN HOME </a> - THIS GAME WAS MADE FOR EDUCATIONAL BENEFIT, NO COPYRIGHT INFRINGEMENT INTENDED
</footer>
</body>
